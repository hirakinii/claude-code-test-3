

# **仕様書作成支援アプリ 論理データモデル設計報告書**

## **I. データモデルの設計概要**

本報告書は、提供されたUIイメージ 1 および要件定義書 2 に基づき、「仕様書作成支援アプリ」がハンドリングする全エンティティを識別し、その論理データモデルを定義するものです。

本アプリケーションのデータアーキテクチャを決定づける最も重要な要件は、「仕様書管理者」が「スキーマ設定」画面 1 を通じて、仕様書作成ウィザードのステップ（カテゴリ）と入力項目（フィールド）を動的に定義・変更できる点にあります \[2: カテゴリ（ステップ）の管理 (CRUD), 2: 入力項目の管理 (CRUD)\]。

この要件は、静的なデータベースカラム（例：specifications テーブルに subject カラムを設ける）では対応不可能です。管理者が「件名」フィールドを削除したり、新たな項目を追加したりするたびにデータベースのスキーマ変更が必要となり、システムの柔軟性が著しく損なわれるためです。

したがって、本論理データモデルは、**メタモデル・アーキテクチャ**を採用します。これは、以下の2つのデータ層を明確に分離する設計です。

1. **スキーマ（定義）層:** 「仕様書管理者」が管理する、仕様書の「型」や「テンプレート」を定義するエンティティ群 (例: Schema, Schema\_Category, Schema\_Field)。これらは、ウィザードの構造、入力項目のデータ型、必須設定などを定義します 1。  
2. **インスタンス（データ）層:** 「仕様書作成者」がウィザードを通じて入力する、個々の「値」を格納するエンティティ群 (例: Specification, Specification\_Content)。

この設計により、アプリケーションロジックは「スキーマ層」を読み込んで動的にUI（ウィザード画面）を構築し、ユーザーが入力した「インスタンス層」のデータを永続化します。これにより、開発者のデプロイ作業なしに、管理者がウィザー  
ドの項目を自由に追加・変更できるという、本アプリの中核的価値が実現されます。  
加えて、「納品物」 3 や「業務タスク」 4 のような「1対多」の動的リスト項目は、独立したサブエンティティとしてモデル化し、中核となる Specification エンティティに関連付けられます。

## **II. 論理データモデル図 (Mermaid 形式)**

以下に、識別された全エンティティとそれらの関連性（リレーションシップ）を示す論理データモデル図を mermaid 形式で提示します。

コード スニペット

erDiagram  
    User {  
        UUID user\_id PK  
        String email "Unique"  
        String password\_hash  
        String full\_name  
        Timestamp created\_at  
    }  
    Role {  
        Integer role\_id PK  
        String role\_name "Unique"  
    }  
    User\_Role {  
        UUID user\_id PK  
        Integer role\_id PK  
    }  
    User ||--|{ Specification : "authors"  
    User }|..|{ Role : "has (User\_Role)"  
    User ||..|| User\_Role : "junction"  
    Role ||..|| User\_Role : "junction"

    Schema {  
        UUID schema\_id PK  
        String schema\_name  
        Boolean is\_default  
        Timestamp created\_at  
        Timestamp updated\_at  
    }  
    Schema\_Category {  
        UUID category\_id PK  
        UUID schema\_id FK  
        String category\_name  
        String description  
        Integer display\_order  
    }  
    Schema\_Field {  
        UUID field\_id PK  
        UUID category\_id FK  
        String field\_name  
        Enum data\_type  
        Boolean is\_required  
        JSON options "For checkbox/radio"  
        String placeholder\_text  
        String list\_target\_entity  
        Integer display\_order  
    }  
    Schema ||--|{ Schema\_Category : "has"  
    Schema\_Category ||--|{ Schema\_Field : "has"

    Specification {  
        UUID specification\_id PK  
        UUID author\_user\_id FK  
        UUID schema\_id FK  
        String title "Nullable (Denormalized)"  
        Enum status  
        String version  
        Timestamp created\_at  
        Timestamp updated\_at  
    }  
    Specification\_Content {  
        UUID content\_id PK  
        UUID specification\_id FK  
        UUID field\_id FK  
        TEXT value "JSONB recommended"  
    }  
    Specification ||--|{ Specification\_Content : "has values for"  
    Schema\_Field ||--|{ Specification\_Content : "is defined by"

    Deliverable {  
        UUID deliverable\_id PK  
        UUID specification\_id FK  
        String name  
        Integer quantity  
        TEXT description  
    }  
    Contractor\_Requirement {  
        UUID req\_id PK  
        UUID specification\_id FK  
        String category  
        TEXT description  
    }  
    Basic\_Business\_Requirement {  
        UUID basic\_req\_id PK  
        UUID specification\_id FK  
        String category  
        TEXT description  
    }  
    Business\_Task {  
        UUID task\_id PK  
        UUID specification\_id FK  
        String title  
        TEXT detailed\_spec  
    }  
    Specification ||--|{ Deliverable : "includes"  
    Specification ||--|{ Contractor\_Requirement : "includes"  
    Specification ||--|{ Basic\_Business\_Requirement : "includes"  
    Specification ||--|{ Business\_Task : "includes"

## **III. 主要エンティティと設計根拠**

本データモデルの中核をなすエンティティ群と、その設計根拠（デザイン・ラショナル）を、提供された要件とUIに基づいて詳述します。

### **3.1. スキーマ・メタモデル (Schema, Schema\_Category, Schema\_Field)**

このエンティティ群は、アプリケーションの最大の提供価値である「仕様書テンプレートのカスタマイズ機能」を実現するための根幹です。これらは「スキーマ設定」画面 1 に対応し、「仕様書管理者」ロールのユーザーによって管理されます \[2: ロールベース・アクセス・コントロール (RBAC)\]。

* **Schema (スキーマ):** テンプレート全体（例：「デフォルトスキーマ」 1）を定義するマスターエンティティです。  
* **Schema\_Category (スキーマ・カテゴリ):** ウィザードの各ステップ（例：「ステップ 1 基本情報」 1）を定義します \[2: カテゴリ（ステップ）の管理 (CRUD)\]。display\_order（順序）属性を保持し、ウィザードのステップ順を制御します。  
* **Schema\_Field (スキーマ・フィールド):** 各カテゴリ内の個別の入力項目（例：「調達の目的」 1）を定義します \[2: 入力項目の管理 (CRUD)\]。  
  * **data\_type 属性:** 'テキスト', 'テキストエリア', 'ラジオボタン', 'チェックボックス', '日付', 'リスト' などの Enum 型（列挙型）です 1。  
  * **is\_required 属性:** '必須' マーク 1 に対応する Boolean 型です。この属性は、ウィザードのバリデーション（例：未入力項目の赤色強調表示 10） 2 および保存ロジック（メジャー/マイナーバージョン分岐） 2 の両方で極めて重要な役割を果たします。  
  * **list\_target\_entity 属性 (推論):** data\_type が 'リスト' の場合、どのサブエンティティ（例: 'Deliverable'）を参照すべきかを示すシグナルとして機能します（詳細は 3.3 を参照）。

この設計により、管理者が「設定」画面 1 でフィールドを追加・削除するだけで、作成者のウィザード画面 3 と確認画面 10 の表示が動的に変更されます。

### **3.2. 動的コンテンツの格納 (Specification\_Content)**

これは、3.1で定義された Schema\_Field（質問）に対する「回答」の値を格納するテーブルであり、メタモデル・アーキテクチャの核となる部分です。一般に EAV (Entity-Attribute-Value) パターンとして知られる設計を採用します。

* **Specification\_Content (仕様書コンテンツ):**  
  * specification\_id (FK): どの仕様書の値かを示します。  
  * field\_id (FK): どの項目（例：「調達の目的」）の値かを示します。  
  * value (TEXT or JSONB): 実際の入力値（例：「調達の目的を入力してください」 8）を格納します。

この value カラムの設計が鍵となります。「調達のスコープ」 9 のようなチェックボックスは、\["コンサルティング", "要件定義支援"\] といった複数の値を配列として保持する必要があります。そのため、このカラムは全ての値を文字列としてシリアライズする TEXT 型、または（可能であれば）配列やオブジェクトをネイティブに格納できる JSONB 型として設計するのが最適です。

このEAV設計により、管理者が Schema\_Field を増減させても Specification\_Content テーブルのスキーマ変更は一切不要となり、最高の柔軟性を実現します。

### **3.3. 1:N サブエンティティ (動的リスト)**

Schema\_Field の data\_type が "リスト" 1 の場合、これは単純な値ではなく、構造化された子オブジェクトのリストを意味します。

これらの「リスト」項目は、EAVテーブル (Specification\_Content) にJSONとして格納することも可能ですが、UIの分析から、それらは独立したサブエンティティとしてモデル化する方が合理的です。

* **分析:**  
  * UIは、「納品物」 3 に「名称」「個数」「説明」という3つの固定フィールドがあることを示しています 3。  
  * UIは、「業務タスク」 4 に「タイトル」「詳細仕様」という2つの固定フィールドがあることを示しています 4。  
  * UIは、「受注者要件」「業務基本要件」 5 に「カテゴリ」「説明」という2つの固定フィールドがあることを示しています 5。  
* **決定的な証拠:**  
  * 「仕様書詳細情報」画面 6 には、「**業務数: 1件**」という集計値が表示されています 6。  
  * この集計は、Business\_Task という独立したテーブルに対して SELECT COUNT(\*) を実行した結果と解釈するのが最も自然かつ効率的です。EAVテーブル内のJSONBフィールドをスキャンしてカウントするのは非現実的です。  
* 結論:  
  Schema\_Field の "リスト" 型（例：「納品物」 1）は、EAV (Specification\_Content) に値を保存するのではなく、「Deliverable という別のテーブルを参照せよ」というUIロジックへのシグナルとして機能します。したがって、以下の独立したエンティティを定義します。  
  * **Deliverable (納品物):** specification\_id (FK) を持ち、納品物のリストを格納します。  
  * **Business\_Task (業務タスク):** specification\_id (FK) を持ち、業務タスクのリストを格納します。  
  * **Contractor\_Requirement (受注者要件):** specification\_id (FK) を持ちます。  
  * **Basic\_Business\_Requirement (業務基本要件):** specification\_id (FK) を持ちます。

### **3.4. 中核エンティティ (Specification)**

Specification（仕様書）は、すべてのデータインスタンス（作成者による入力内容）を集約する「マスター」エンティティです。

* specification\_id (PK): 新規作成時に採番されます 2。  
* author\_user\_id (FK): "自分が作成・管理している" 2 を実現するため、User エンティティと関連付けられます。  
* schema\_id (FK): この仕様書がどの Schema（テンプレート）を利用しているかを示します。これは、保存時のバリデーションロジック（要件41）に不可欠です。  
* status (Enum): '編集中', '確認中', '保存済み' といった仕様書の現在の状態を管理します 2。この値は、トップページの「操作」ボタンの制御（編集/詳細） 2 や、保存ロジック 2 で使用されます。  
* version (String): "1.0", "1.1" などのバージョン番号を保持します 7。  
* title (String, Denormalized):  
  * **デノーマライゼーション（非正規化）の適用:** 「件名」 8 は、本来 3.1 および 3.2 で述べた通り、Schema\_Field で定義され Specification\_Content (EAV) に格納される動的データです。  
  * **設計上の課題:** しかし、「件名」はトップページの一覧 7 で表示されます 7。一覧表示のたびに Specification\_Content テーブルを JOIN して "件名" の value を探すのは、非効率なクエリとなり、深刻なパフォーマンス低下を引き起こします。  
  * **解決策:** Specification テーブル自体に title カラムを（非正規化して）保持します。仕様書保存時、アプリケーションロジックが Specification\_Content から「件名」の value を取得し、この title カラムにコピーします。トップページ 7 に表示される「(件名未設定)」は、この title カラムが NULL または空文字列である場合の表示ロジックです。

### **3.5. ユーザーと権限 (User, Role, User\_Role)**

システムのセキュリティと機能へのアクセス分離を実現するために不可欠なエンティティ群です 2。

* **User (ユーザー):** ログインする個人を識別します。  
* **Role (ロール):** 「仕様書作成者」と「仕様書管理者」という2つの主要なロールを定義します \[2: ロールベース・アクセス・コントロール (RBAC)\]。  
* **User\_Role (ジャンクションテーブル):** ユーザーとロールの多対多（N:M）関係を解決します。  
* **権限の適用:** アプリケーションロジックは、ログインユーザーの Role を確認します。「仕様書管理者」ロールを持つユーザーのみが、トップページの「設定」ボタン 2 にアクセスでき、Schema エンティティ群（3.1）の編集権限を持ちます。

## **IV. エンティティ・属性リスト（データディクショナリ）**

以下に、識別された全エンティティと属性を、要求された表形式で網羅的にリストアップします。

**凡例:**

* **PK:** Primary Key (主キー)  
* **FK:** Foreign Key (外部キー)  
* **Enum:** Enumerated Type (列挙型)。特定の文字列リストのみを許容する型。

---

**表 1: ユーザーおよび権限エンティティ**

| 項番 | エンティティ名 | 属性 | 属性のデータ型 | 属性が利用される要件名 |
| :---- | :---- | :---- | :---- | :---- |
| 1.1 | **User (ユーザー)** | user\_id | UUID (PK) | ユーザー認証（推測） |
| 1.2 | User | email | String (Unique) | ユーザー認証（推測） |
| 1.3 | User | password\_hash | String | ユーザー認証（推測） |
| 1.4 | User | full\_name | String | （推測） |
| 1.5 | User | created\_at | Timestamp | （推測） |
| 2.1 | **Role (ロール)** | role\_id | Integer (PK) | ロールベース・アクセス・コントロール (RBAC)（推測） |
| 2.2 | Role | role\_name | String (Unique) | ロールベース・アクセス・コントロール (RBAC)（推測） (例: 'administrator', 'creator') |
| 3.1 | **User\_Role (ユーザーロール)** | user\_id | UUID (FK, PK) | ロールベース・アクセス・コントロール (RBAC)（推測） |
| 3.2 | User\_Role | role\_id | Integer (FK, PK) | ロールベース・アクセス・コントロール (RBAC)（推測） |

---

**表 2: スキーマ（メタモデル）エンティティ**

| 項番 | エンティティ名 | 属性 | 属性のデータ型 | 属性が利用される要件名 |
| :---- | :---- | :---- | :---- | :---- |
| 4.1 | **Schema (スキーマ)** | schema\_id | UUID (PK) | 画面: スキーマ設定 |
| 4.2 | Schema | schema\_name | String | 画面: スキーマ設定 1 |
| 4.3 | Schema | is\_default | Boolean | スキーマのデフォルト復元 |
| 4.4 | Schema | created\_at | Timestamp | （推測） |
| 4.5 | Schema | updated\_at | Timestamp | 画面: スキーマ設定 1 |
| 5.1 | **Schema\_Category (スキーマ・カテゴリ)** | category\_id | UUID (PK) | カテゴリ（ステップ）の管理 (CRUD) |
| 5.2 | Schema\_Category | schema\_id | UUID (FK) | 画面: スキーマ設定 |
| 5.3 | Schema\_Category | category\_name | String | カテゴリ（ステップ）の管理 (CRUD) 1 |
| 5.4 | Schema\_Category | description | String | カテゴリ（ステップ）の管理 (CRUD) 1 |
| 5.5 | Schema\_Category | display\_order | Integer | カテゴリ（ステップ）の管理 (CRUD) (ウィザードのステップ順序を定義するため推測) |
| 6.1 | **Schema\_Field (スキーマ・フィールド)** | field\_id | UUID (PK) | 入力項目の管理 (CRUD) |
| 6.2 | Schema\_Field | category\_id | UUID (FK) | 入力項目の管理 (CRUD) |
| 6.3 | Schema\_Field | field\_name | String | 入力項目の管理 (CRUD) 1 |
| 6.4 | Schema\_Field | data\_type | Enum | 入力項目のデータ型定義 1 |
| 6.5 | Schema\_Field | is\_required | Boolean | 入力項目の必須設定 1 |
| 6.6 | Schema\_Field | options | JSON/Text | 入力項目のデータ型定義 9 |
| 6.7 | Schema\_Field | placeholder\_text | String | 8 |
| 6.8 | Schema\_Field | display\_order | Integer | 入力項目の管理 (CRUD) (カテゴリ内の項目順序を定義するため推測) |
| 6.9 | Schema\_Field | list\_target\_entity | String | 入力項目のデータ型定義 (data\_type='list' の場合の参照先エンティティ名。例: 'Deliverable', 'Business\_Task') |

---

**表 3: 仕様書（データ）エンティティ**

| 項番 | エンティティ名 | 属性 | 属性のデータ型 | 属性が利用される要件名 |
| :---- | :---- | :---- | :---- | :---- |
| 7.1 | **Specification (仕様書)** | specification\_id | UUID (PK) | 新規仕様書の作成開始 |
| 7.2 | Specification | author\_user\_id | UUID (FK) | ユーザー認証（推測） 2 |
| 7.3 | Specification | schema\_id | UUID (FK) | 保存処理とバージョン管理ロジック (バリデーションの元スキーマを特定) |
| 7.4 | Specification | title | String (Nullable) | 仕様書一覧表示 7 |
| 7.5 | Specification | status | Enum | ステータスの視覚的識別 7 |
| 7.6 | Specification | version | String | 仕様書一覧表示 7 |
| 7.7 | Specification | created\_at | Timestamp | 画面: 仕様書詳細情報 6 |
| 7.8 | Specification | updated\_at | Timestamp | 仕様書一覧表示 7 |
| 8.1 | **Specification\_Content (仕様書コンテンツ)** | content\_id | UUID (PK) | (EAVモデル) |
| 8.2 | Specification\_Content | specification\_id | UUID (FK) | 入力データの自動保存（ローカルストレージ） (DB永続化時) |
| 8.3 | Specification\_Content | field\_id | UUID (FK) | 入力データの自動保存（ローカルストレージ） (DB永続化時) |
| 8.4 | Specification\_Content | value | TEXT / JSONB | 基本情報（件名、背景、目的）の入力 8, 調達の種別とスコープの入力 9, 納品情報（期限、場所、担当者）の入力 3 |

---

**表 4: 1:N サブエンティティ（動的リスト）**

| 項番 | エンティティ名 | 属性 | 属性のデータ型 | 属性が利用される要件名 |
| :---- | :---- | :---- | :---- | :---- |
| 9.1 | **Deliverable (納品物)** | deliverable\_id | UUID (PK) | 動的リスト項目追加 (納品物) |
| 9.2 | Deliverable | specification\_id | UUID (FK) | 動的リスト項目追加 (納品物) |
| 9.3 | Deliverable | name | String | 動的リスト項目追加 (納品物) 3 |
| 9.4 | Deliverable | quantity | Integer | 動的リスト項目追加 (納品物) 3 |
| 9.5 | Deliverable | description | TEXT | 動的リスト項目追加 (納品物) 3 |
| 10.1 | **Contractor\_Requirement (受注者要件)** | req\_id | UUID (PK) | 動的リスト項目追加 (受注者要件) |
| 10.2 | Contractor\_Requirement | specification\_id | UUID (FK) | 動的リスト項目追加 (受注者要件) |
| 10.3 | Contractor\_Requirement | category | String | 動的リスト項目追加 (受注者要件) 5 |
| 10.4 | Contractor\_Requirement | description | TEXT | 動的リスト項目追加 (受注者要件) 5 |
| 11.1 | **Basic\_Business\_Requirement (業務基本要件)** | basic\_req\_id | UUID (PK) | 動的リスト項目追加 (業務基本要件) |
| 11.2 | Basic\_Business\_Requirement | specification\_id | UUID (FK) | 動的リスト項目追加 (業務基本要件) |
| 11.3 | Basic\_Business\_Requirement | category | String | 動的リスト項目追加 (業務基本要件) 5 |
| 11.4 | Basic\_Business\_Requirement | description | TEXT | 動的リスト項目追加 (業務基本要件) 5 |
| 12.1 | **Business\_Task (業務タスク)** | task\_id | UUID (PK) | 動的リスト項目追加 (業務タスク) |
| 12.2 | Business\_Task | specification\_id | UUID (FK) | 動的リスト項目追加 (業務タスク) |
| 12.3 | Business\_Task | title | String | 動的リスト項目追加 (業務タスク) 4 |
| 12.4 | Business\_Task | detailed\_spec | TEXT | 動的リスト項目追加 (業務タスク) 4 |

#### **引用文献**

1. 仕様書作成Webアプリ-2-設定画面.pdf  
2. 仕様書作成支援アプリ\_要件定義書  
3. 仕様書作成Webアプリ-4.3-納品情報画面.pdf  
4. 仕様書作成Webアプリ-4.5-各業務の詳細仕様画面.pdf  
5. 仕様書作成Webアプリ-4.4-受注者等の要件画面.pdf  
6. 仕様書作成Webアプリ-3-仕様書詳細情報画面.pdf  
7. 仕様書作成Webアプリ-1-トップページ.pdf  
8. 仕様書作成Webアプリ-4.1-基本情報画面.pdf  
9. 仕様書作成Webアプリ-4.2-調達の種別とスコープ画面.pdf  
10. 仕様書作成Webアプリ-4.6-仕様確認と保存画面.pdf